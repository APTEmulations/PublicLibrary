## TA551
#### Aliases: GOLD CABIN, Shathak
### Ranking #1 in Red Canary’s Report for Top Threats
###### [Report:TA551](https://redcanary.com/threat-detection-report/threats/ta551/) "TA551 was the most prevalent threat Red Canary encountered in 2020 by a wide margin. Its pervasiveness was revealed not only in the volume of detections, but in the number of organizations affected across multiple industries and company sizes."
###### Detection: Be sure to observe the "Detection Opportunities” at the bottom of the report section.
###### Main Resources: [ATT&CK TA551](https://attack.mitre.org/groups/G0127/), [Unit42 TA551](https://unit42.paloaltonetworks.com/ta551-shathak-icedid/), [Atomic Red Team ATT&CK Navigator Layer for Windows](https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/Indexes/Attack-Navigator-Layers/art-navigator-layer-windows.json), [Unit42 IOC Repo](https://github.com/pan-unit42/iocs/tree/master/TA551)
###### The Goal: To cover the techniques and sub-techniques to the fullest extent possible. These are not perfect replications of the attack. The procedure is not exact. The sub-techniques may not have a perfect atomic, that is not the goal. Using the best possible test to prompt better detection and coverage is the goal.


### Emulation Plan
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"><link type="text/css" rel="stylesheet" href="resources/sheet.css" >
<div class="ritz grid-container" dir="ltr"><table class="waffle" cellspacing="0" cellpadding="0"><thead></thead><tbody><tr style="height: 20px"><th id="738770828R0" style="height: 20px;" class="row-headers-background"><div class="row-header-wrapper" style="line-height: 20px">1</div></th><td class="s0" dir="ltr">Technique Name &amp; Number</td><td class="s0">Sub-Technique &amp; Number</td><td class="s0">Atomic Red Team Test</td><td class="s0">Reference Reports</td><td class="s0" dir="ltr">Notes/Comments/Use cases from ATT&amp;CK</td></tr><tr style="height: 20px"><th id="738770828R1" style="height: 20px;" class="row-headers-background"><div class="row-header-wrapper" style="line-height: 20px">2</div></th><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1566/">Phishing: T1566</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1566/001/">T1566.001 - Spearphishing Attachment</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1566.001/T1566.001.md#atomic-test-1---download-macro-enabled-phishing-attachment">Atomic Test #1 - Download Macro-Enabled Phishing Attachment</a></td><td class="s2" dir="ltr">D2</td><td class="s2" dir="ltr">E2</td></tr><tr style="height: 20px"><th id="738770828R2" style="height: 20px;" class="row-headers-background"><div class="row-header-wrapper" style="line-height: 20px">3</div></th><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1204/">User Execution: T1204</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1204/002/">T1204.002 - Malicious File</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1204.002/T1204.002.md#atomic-test-3---maldoc-choice-flags-command-execution">Atomic Test #3 - Maldoc choice flags command execution</a></td><td class="s2"></td><td class="s2"></td></tr><tr style="height: 20px"><th id="738770828R3" style="height: 20px;" class="row-headers-background"><div class="row-header-wrapper" style="line-height: 20px">4</div></th><td class="s2" dir="ltr"></td><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1204/002/">T1204.002 - Malicious File</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1204.002/T1204.002.md#atomic-test-6---excel-4-macro">Atomic Test #6 - Excel 4 Macro</a></td><td class="s2" dir="ltr"></td><td class="s2"></td></tr><tr style="height: 20px"><th id="738770828R4" style="height: 20px;" class="row-headers-background"><div class="row-header-wrapper" style="line-height: 20px">5</div></th><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1059/">Command and Scripting Interpreter: T1059</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1059.003/T1059.003.md#t1059003---windows-command-shell">T1059.003 - Windows Command Shell</a></td><td class="s2"></td><td class="s2"></td><td class="s2"></td></tr><tr style="height: 20px"><th id="738770828R5" style="height: 20px;" class="row-headers-background"><div class="row-header-wrapper" style="line-height: 20px">6</div></th><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1036/">Masquerading: T1036</a></td><td class="s2" dir="ltr">--</td><td class="s1" dir="ltr"><a target="_blank" href="https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1036/T1036.md#atomic-test-2---malware-masquerading-and-execution-from-zip-file">Atomic Test #2 - Malware Masquerading and Execution from Zip File</a></td><td class="s2"></td><td class="s2"></td></tr><tr style="height: 20px"><th id="738770828R6" style="height: 20px;" class="row-headers-background"><div class="row-header-wrapper" style="line-height: 20px">7</div></th><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1027/">Obfuscated Files or Information: T1027</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1027/003/">Steganography: T1027.003</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1027/T1027.md#atomic-test-4---execution-from-compressed-file">Atomic Test #4 - Execution from Compressed File</a></td><td class="s2" dir="ltr"></td><td class="s2" dir="ltr">E7</td></tr><tr style="height: 20px"><th id="738770828R7" style="height: 20px;" class="row-headers-background"><div class="row-header-wrapper" style="line-height: 20px">8</div></th><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1218/">System Binary Proxy Execution: T1218</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1218/005/">Mshta: T1218.005</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218.005/T1218.005.md#atomic-test-2---mshta-executes-vbscript-to-execute-malicious-command">Atomic Test #2 - Mshta executes VBScript to execute malicious command</a></td><td class="s2" dir="ltr"></td><td class="s2" dir="ltr">E8</td></tr><tr style="height: 20px"><th id="738770828R8" style="height: 20px;" class="row-headers-background"><div class="row-header-wrapper" style="line-height: 20px">9</div></th><td class="s2" dir="ltr"></td><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1218/005/">Mshta: T1218.005</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218.005/T1218.005.md#atomic-test-10---mshta-used-to-execute-powershell">Atomic Test #10 - Mshta used to Execute PowerShell</a></td><td class="s2" dir="ltr"></td><td class="s2" dir="ltr"></td></tr><tr style="height: 20px"><th id="738770828R9" style="height: 20px;" class="row-headers-background"><div class="row-header-wrapper" style="line-height: 20px">10</div></th><td class="s2"></td><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1218/010/">Regsvr32: T1218.010</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218.010/T1218.010.md#atomic-test-3---regsvr32-local-dll-execution">Atomic Test #3 - Regsvr32 local DLL execution</a></td><td class="s2" dir="ltr"></td><td class="s2" dir="ltr">E10</td></tr><tr style="height: 20px"><th id="738770828R10" style="height: 20px;" class="row-headers-background"><div class="row-header-wrapper" style="line-height: 20px">11</div></th><td class="s2"></td><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1218/011/">Rundll32: T1218.011</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1218.011/T1218.011.md#atomic-test-5---rundll32-syssetupdll-execution">Atomic Test #5 - Rundll32 syssetup.dll Execution</a></td><td class="s2" dir="ltr"></td><td class="s2" dir="ltr">E11</td></tr><tr style="height: 20px"><th id="738770828R11" style="height: 20px;" class="row-headers-background"><div class="row-header-wrapper" style="line-height: 20px">12</div></th><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1071/">Application Layer Protocol: T1071</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1071/001/">Web Protocols: T1071.001</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1071.001/T1071.001.md#atomic-test-1---malicious-user-agents---powershell">Atomic Test #1 - Malicious User Agents - Powershell</a></td><td class="s2" dir="ltr">D12</td><td class="s2" dir="ltr">E12</td></tr><tr style="height: 20px"><th id="738770828R12" style="height: 20px;" class="row-headers-background"><div class="row-header-wrapper" style="line-height: 20px">13</div></th><td class="s2" dir="ltr"></td><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1071/001/">Web Protocols: T1071.001</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1071.001/T1071.001.md#atomic-test-2---malicious-user-agents---cmd">Atomic Test #2 - Malicious User Agents - CMD</a></td><td class="s2" dir="ltr"></td><td class="s2" dir="ltr"></td></tr><tr style="height: 20px"><th id="738770828R13" style="height: 20px;" class="row-headers-background"><div class="row-header-wrapper" style="line-height: 20px">14</div></th><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1132/">Data Encoding: T1132</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1132/001/">Standard Encoding: T1132.001</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1132.001/T1132.001.md#atomic-test-2---xor-encoded-data">Atomic Test #2 - XOR Encoded data.</a></td><td class="s2"></td><td class="s2" dir="ltr">E14</td></tr><tr style="height: 20px"><th id="738770828R14" style="height: 20px;" class="row-headers-background"><div class="row-header-wrapper" style="line-height: 20px">15</div></th><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1568/">Dynamic Resolution: T1568</a></td><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1568/002/">Domain Generation Algorithms: T1568.002</a></td><td class="s2" dir="ltr">N/A Atomic Needed. See References.</td><td class="s2" dir="ltr">D15</td><td class="s2" dir="ltr">E15</td></tr><tr style="height: 20px"><th id="738770828R15" style="height: 20px;" class="row-headers-background"><div class="row-header-wrapper" style="line-height: 20px">16</div></th><td class="s1" dir="ltr"><a target="_blank" href="https://attack.mitre.org/techniques/T1105/">Ingress Tool Transfer: T1105</a></td><td class="s2" dir="ltr">--</td><td class="s1" dir="ltr"><a target="_blank" href="https://github.com/redcanaryco/atomic-red-team/blob/master/atomics/T1105/T1105.md#atomic-test-15---file-download-via-powershell">Atomic Test #15 - File Download via PowerShell</a></td><td class="s2" dir="ltr">D16</td><td class="s2" dir="ltr">E16</td></tr></tbody></table></div>


#### Footnotes:
###### Researcher & Contributor [@DragosLMalfoy](https://twitter.com/DragosLMalfoy) 
###### D2: [Unit42:Email Attack Campaign Switches from Valak to IcedID](https://unit42.paloaltonetworks.com/ta551-shathak-icedid/)
###### D12: [Evolution of Valak, from Its Beginnings to Mass Distribution](https://unit42.paloaltonetworks.com/valak-evolution/)
###### D15: [Infosec: A Resource that will walk you through this technique](https://resources.infosecinstitute.com/topic/domain-generation-algorithm-dga/)
###### D16: In recent weeks, TA551 has changed traffic patterns. For several months prior to Oct. 19, 2020, URLs generated by Word macros to retrieve installer binaries followed a noticeable pattern. [This pattern includes:](https://unit42.paloaltonetworks.com/ta551-shathak-icedid/)
###### E2: "Organizations that have implemented a restrictive macro policy disrupt this attack by preventing the execution of malicious code."
###### E7: There is not yet a Steganography T1027.003 Atomic yet. The test chosen is part of T1027, and mimics execution of a compressed file. 
###### E8: [TA551 has used mshta.exe to execute malicious payloads.](https://attack.mitre.org/groups/G0127/)
###### E10: TA551 has used regsvr32.exe to load malicious DLLs.
###### E11: TA551 has used rundll32.exe to load malicious DLLs.
###### E12: TA551 has used HTTP for C2 communications.
###### E14: TA551 has used encoded ASCII text for initial C2 communications. There are currently two atomics in this sub-technique. For Windows, the available test will use an XOR key used for encoding the plaintext.
###### E15: [ATT&CK T1568.002](https://attack.mitre.org/techniques/T1568/002/), [DGA](https://umbrella.cisco.com/blog/domain-generation-algorithms-effective)
###### E16: Many useful atomics for 1105.While this test is not using a malicious word macro, is it a good detection opportunity for the technique.TA551 has retrieved DLLs and installer binaries for malware execution from C2.

###### Reach out on twitter with questions: @AptEmulations or to the contributor: [@DLLpwns](https://twitter.com/DragosLMalfoy) 
